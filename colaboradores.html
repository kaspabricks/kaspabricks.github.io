<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KASBRICKS SUPPORTERS</title>
  <style>
    * {
      margin: 0; padding: 0; box-sizing: border-box;
    }

    html, body {
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background-color: #222;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #grid {
      display: grid;
      width: 95vw;
      height: 95vh;
      gap: 10px;
      grid-template-columns: repeat(5, 1fr);
    }

    .grid-item {
      position: relative;
      overflow: visible;
    }

    .grid-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 8px;
      border: 2px solid #444;
      background-color: #222;
      user-select: none;
      display: block;
      transition: transform 0.2s ease, z-index 0.2s ease;
      cursor: pointer;
    }

    .grid-item:hover {
      z-index: 1000;
    }

    .grid-item:hover img {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(1.5);
      max-width: 80vw;
      max-height: 80vh;
      object-fit: contain;
      border: 3px solid #666;
      box-shadow: 0 0 20px rgba(0,0,0,0.6);
    }
  </style>
</head>
<body>
  <div id="grid">
    <!-- Imágenes fijas -->
    <div class="grid-item"><img src="1.jpg" alt="1"></div>
    <div class="grid-item"><img src="2.jpg" alt="2"></div>
    <div class="grid-item"><img src="3.jpg" alt="3"></div>
    <div class="grid-item"><img src="4.jpg" alt="4"></div>
    <div class="grid-item"><img src="5.jpg" alt="5"></div>
    <div class="grid-item"><img src="6.jpg" alt="6"></div>
    <div class="grid-item"><img src="7.jpg" alt="7"></div>
    <div class="grid-item"><img src="8.jpg" alt="8"></div>
    <div class="grid-item"><img src="9.jpg" alt="9"></div>
    <div class="grid-item"><img src="10.jpg" alt="10"></div>
    <div class="grid-item"><img src="11.jpg" alt="11"></div>
  </div>

  <!-- Canvas oculto -->
  <canvas id="canvas" style="display:none;"></canvas>

  <script>
    function ajustarAlturaFilas() {
      const grid = document.getElementById('grid');
      const totalImgs = grid.children.length;
      const columnas = 5;
      const filas = Math.ceil(totalImgs / columnas);
      const alturaGrid = window.innerHeight * 0.95;
      const gap = 10;
      const totalGapHeight = gap * (filas - 1);
      const alturaFilaPx = (alturaGrid - totalGapHeight) / filas;
      grid.style.gridAutoRows = `${alturaFilaPx}px`;
    }

    window.addEventListener('resize', ajustarAlturaFilas);
    window.addEventListener('load', ajustarAlturaFilas);

    // --- Canvas y lógica del contador ---
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const fondo = new Image();
    fondo.src = 'fondo.jpg';  // Asegúrate de que exista en tu carpeta

    const anguloGrados = -4;
    const anguloRad = anguloGrados * Math.PI / 180;
    const WALLET = 'kaspa:qrg43uan89750atpur08ljvlxv36gyf82gy3hf5zq0h0urcsjlfsvk473y4wr';
    const API_URL = `https://api-v2-private.kas.fyi/addresses/${WALLET}/info`;
    const MAX_KASPA = 100000;

    let currentTexto = '...';
    let imagenCanvasRef = null; // <- Referencia al <img> generado por el canvas

    fondo.onload = () => {
      resizeCanvas();
      actualizarBalance();
      setInterval(actualizarBalance, 60000); // Actualiza cada minuto
    };

    function resizeCanvas() {
      const size = Math.min(window.innerWidth, window.innerHeight);
      canvas.width = size;
      canvas.height = size;
    }

    async function actualizarBalance() {
      try {
        const res = await fetch(API_URL);
        if (!res.ok) throw new Error('Error al consultar la API');
        const data = await res.json();

        let balance = data.balance ? Number(data.balance) / 100000000 : 0;
        const porcentaje = (balance / MAX_KASPA) * 100;
        actualizarCanvas(porcentaje.toFixed(2));
      } catch (e) {
        console.error('Error:', e);
        actualizarCanvas('Err');
      }
    }

    function actualizarCanvas(texto) {
      currentTexto = texto;

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(fondo, 0, 0, canvas.width, canvas.height);

      const x = canvas.width * 0.35;
      const y = canvas.height * 0.43;

      ctx.save();
      ctx.translate(x, y);
      ctx.rotate(anguloRad);

      const fontSize = Math.floor(canvas.width * 0.17);
      ctx.font = `${fontSize}px Impact`;
      ctx.textBaseline = 'top';

      const offsetX = parseFloat(texto) < 10 ? fontSize * 0.33 : 0;

      ctx.globalCompositeOperation = 'destination-out';
      ctx.fillText(texto + '%', offsetX, 0);
      ctx.restore();

      ctx.globalCompositeOperation = 'source-over';

      insertarOActualizarImagenCanvas();
    }

    function insertarOActualizarImagenCanvas() {
      const dataURL = canvas.toDataURL('image/png');

      if (!imagenCanvasRef) {
        // Primera vez: crear imagen y agregar al grid
        const img = document.createElement('img');
        img.src = dataURL;
        img.alt = 'Canvas generado';

        const div = document.createElement('div');
        div.className = 'grid-item';
        div.appendChild(img);

        document.getElementById('grid').appendChild(div);
        imagenCanvasRef = img;

        ajustarAlturaFilas();
      } else {
        // Ya existe: solo actualizar src
        imagenCanvasRef.src = dataURL;
      }
    }
  </script>
</body>
</html>
