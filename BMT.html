<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FAP monkey adventures vs BTC Maxis</title>
<style>
  body { margin:0; overflow:hidden; background:#000; }
  canvas { display:block; margin:0 auto; }
  #musicBtn {
    position:absolute; top:10px; right:10px; z-index:1000;
    padding:10px 14px; font-size:24px; cursor:pointer; border-radius:10px;
    border:2px solid white; background:rgba(0,0,0,0.6); color:white;
  }
  #musicBtn:hover { background:rgba(255,255,255,0.2); }

  #startMsg {
    position:absolute;
    top:45%;
    left:50%;
    transform:translate(-50%, -50%);
    padding:40px 60px;
    background:rgba(0,0,0,0.85);
    border:4px solid white;
    color:#FFD700;
    font-size:42px;
    font-family:'Arial Black', Arial, sans-serif;
    text-align:center;
    border-radius:20px;
    box-shadow: 0 0 20px rgba(255,255,255,0.7);
    opacity:1;
    transition:opacity 1s ease-out;
    z-index:2000;
  }
</style>
</head>
<body>

<div id="startMsg">COLLECT 25 JARS TO FACE SAYLOR</div>
<canvas id="game" width="900" height="500"></canvas>
<button id="musicBtn">Music On</button>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const WORLD_WIDTH = 2000;

// -------- RESOURCES --------
const playerGif = new Image(); playerGif.src = "monito.gif";
const enemySprite = new Image(); enemySprite.src = "mario.png";
const bossSprite = new Image(); bossSprite.src = "MS.png";
const bgDefault = new Image(); bgDefault.src = "fondo.jpg";
const bgFlash = new Image(); bgFlash.src = "saylorloco.jpg"; 
const winImg = new Image(); winImg.src = "win.png";

let currentBg = bgDefault;

// -------- AUDIO --------
const monitoSound = new Audio("monito.mp3");
const damageSound = new Audio("damage.mp3");
const bgMusic = new Audio("jumanji.mp3"); bgMusic.loop = true; bgMusic.volume = 0.3;
const bossSound = new Audio("second.mp3");
const winSound = new Audio("risa.mp3");

// -------- CONFIG --------
const GRAVITY = 0.7;
let cameraX = 0;
let survivalTime = 0;
let killCount = 0;
let boss = null;
let bossAppeared = false;
let invincible = false;
let win = false;
let gameOver = false;

// ------- SCREEN SHAKE -------
let screenShake = false;
let shakeEndTime = 0;

// ------- PLAYER -------
let player = {
  x: 100, y: 0, w: 50, h: 50,
  originalW: 50, originalH: 50,
  vx: 0, vy: 0, speed: 5, jumpPower: 15,
  grounded: false, facing: 1
};

// ------- INPUT -------
const keys = {};
window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

// ------- PLATFORMS -------
const platforms = [
  {x:0,   y:450, w:2000, h:50},
  {x:300, y:350, w:200, h:20},
  {x:650, y:300, w:200, h:20},
  {x:1200,y:330, w:200, h:20}
];

const walls = [
  {x:-50, y:0, w:50, h:500},
  {x:2000,y:0, w:50, h:500}
];

// ------- ENEMIES -------
let enemies = [];
let lastEnemySpawn = Date.now();

// ------- COLLISION -------
function aabb(a, b) {
  return a.x < b.x + b.w && a.x + a.w > b.x &&
         a.y < b.y + b.h && a.y + a.h > b.y;
}

function resolveCollision(entity, platform) {
  if (!aabb(entity, platform)) return;

  const dxLeft   = entity.x + entity.w - platform.x;
  const dxRight  = platform.x + platform.w - entity.x;
  const dyTop    = entity.y + entity.h - platform.y;
  const dyBottom = platform.y + platform.h - entity.y;
  const minX = Math.min(dxLeft, dxRight);
  const minY = Math.min(dyTop, dyBottom);

  if (minX < minY) { 
    if (entity.x < platform.x) entity.x = platform.x - entity.w;
    else entity.x = platform.x + platform.w;
    entity.vx = 0;
  } else { 
    if (entity.vy > 0) {
      entity.y = platform.y - entity.h;
      entity.vy = 0;
      entity.grounded = true;
    } else if (entity.vy < 0) {
      entity.y = platform.y + platform.h;
      entity.vy = 0;
    }
  }
}

// ------- PLAYER UPDATE -------
function updatePlayer() {
  if (keys["ArrowRight"] || keys["d"]) { player.vx = player.speed; player.facing = 1; }
  else if (keys["ArrowLeft"] || keys["a"]) { player.vx = -player.speed; player.facing = -1; }
  else player.vx *= 0.8;

  if ((keys["ArrowUp"] || keys["w"] || keys[" "]) && player.grounded) {
    player.vy = -player.jumpPower;
    player.grounded = false;
    beep(300, 0.08);
  }

  player.vy += GRAVITY;
  player.x += player.vx;
  player.y += player.vy;
  player.grounded = false;

  for (const p of platforms) resolveCollision(player, p);
  for (const w of walls) resolveCollision(player, w);

  if (player.y > 700) { gameOver = true; beep(80, 0.6); }

  cameraX = Math.max(0, Math.min(WORLD_WIDTH - canvas.width, player.x - canvas.width/2));
}

// ------- ENEMY SPAWN -------
function spawnEnemy() {
  if (bossAppeared || win) return;
  const side = Math.random() < 0.5 ? 1 : -1;
  const distance = 500 + Math.random() * 400;
  enemies.push({
    x: player.x + side * distance,
    y: 0,
    w: 40, h: 40,
    vx: side * -2.5,
    vy: 0,
    grounded: false
  });
}

// ------- ENEMY UPDATE -------
function updateEnemies() {
  for (let i = enemies.length - 1; i >= 0; i--) {
    const e = enemies[i];
    e.vy += GRAVITY;
    e.x += e.vx;
    e.y += e.vy;
    e.grounded = false;

    for (const p of platforms) resolveCollision(e, p);
    for (const w of walls) if (aabb(e, w)) e.vx *= -1;

    if (aabb(player, e)) {
      if (player.vy > 0 || invincible) {
        enemies.splice(i, 1);
        killCount++;
        damageSound.currentTime = 0; damageSound.play();

        // --- NORMAL FLASH ---
        currentBg = bgFlash;
        setTimeout(() => currentBg = bgDefault, 400);

        // --- EASTER EGG KILL 13 ---
        if (killCount === 13) {
          const scream = new Audio("scream.mp3");
          scream.play();
          const previousBg = currentBg;
          currentBg = new Image();
          currentBg.src = "rajat.jpg";
          screenShake = true;
          shakeEndTime = Date.now() + 3000;
          setTimeout(() => {
            currentBg = previousBg;
            screenShake = false;
          }, 3000);
        }

        // --- POWER UP (KILL 10) ---
        if (killCount === 10 && !invincible) {
          player.w = player.h = 100;
          invincible = true;
          monitoSound.loop = true; 
          monitoSound.play();

          // SHAKE FOR 15s
          screenShake = true;
          shakeEndTime = Date.now() + 15000;

          setTimeout(() => {
            player.w = player.originalW;
            player.h = player.originalH;
            invincible = false;
            monitoSound.pause();
            monitoSound.currentTime = 0;

            // end shake
            screenShake = false;

          }, 15000);
        }

      } else {
        beep(120, 0.3);
        gameOver = true;
      }
    }
  }

  // --- BOSS ---
  if (killCount >= 25 && !bossAppeared) {
    bossAppeared = true;
    boss = {
      x: player.x + 500,
      y: 300,
      w: 200,
      h: 200,
      vx: 2.2,
      hp: 6,
      spawnTime: Date.now()
    };
    bossSound.play();
    setTimeout(() => enemies = [], 400);
  }

  if (boss) {
    if (player.x > boss.x) boss.vx = 2.2;
    else boss.vx = -2.2;

    boss.x += boss.vx;
    boss.y = 300;

    for (const w of walls) {
      if (aabb(boss, w)) boss.vx *= -1;
    }

    if (Date.now() - boss.spawnTime > 500 && aabb(player, boss)) {
      const stomp = (player.vy > 0 && player.y + player.h < boss.y + 40);
      if (stomp || invincible) {
        boss.hp--;
        damageSound.play();
        player.vy = -12;
        if (boss.hp <= 0) {
          boss = null;
          win = true;
          winSound.play();
        }
      } else {
        beep(100, 0.4);
        gameOver = true;
      }
    }
  }

  if (!bossAppeared && !win && Date.now() - lastEnemySpawn > 1400) {
    spawnEnemy();
    lastEnemySpawn = Date.now();
  }

  if (screenShake && Date.now() > shakeEndTime) screenShake = false;
}

// ------- DRAW -------
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if (currentBg.complete)
    ctx.drawImage(currentBg, 0,0, canvas.width, canvas.height);

  ctx.save();

  let shakeX = 0, shakeY = 0;
  if(screenShake){
    const intensity = 8;
    shakeX = (Math.random() - 0.5) * 2 * intensity;
    shakeY = (Math.random() - 0.5) * 2 * intensity;
  }
  ctx.translate(-cameraX + shakeX, shakeY);

  ctx.fillStyle="#654321";
  for(const p of platforms) ctx.fillRect(p.x,p.y,p.w,p.h);
  
  ctx.fillStyle="#333";
  for(const w of walls) ctx.fillRect(w.x,w.y,w.w,w.h);

  for(const e of enemies)
    if(enemySprite.complete) ctx.drawImage(enemySprite, e.x,e.y,e.w,e.h);

  if(boss && bossSprite.complete)
    ctx.drawImage(bossSprite, boss.x, boss.y, boss.w, boss.h);

  if(playerGif.complete && !win) {
    ctx.save();
    ctx.translate(player.x+player.w/2, player.y+player.h/2);
    ctx.scale(player.facing,1);
    ctx.drawImage(playerGif,-player.w/2,-player.h/2,player.w,player.h);
    ctx.restore();
  }

  ctx.restore();

  ctx.fillStyle="white";
  ctx.font="22px Arial";
  ctx.fillText(`Time: ${Math.floor(survivalTime)}s`,20,34);
  ctx.fillText(`Jars: ${killCount}`,20,64);

  if(gameOver){
    ctx.fillStyle="rgba(0,0,0,0.75)";
    ctx.fillRect(canvas.width/2-200,canvas.height/2-80,400,160);
    ctx.strokeStyle="white"; ctx.lineWidth=4;
    ctx.strokeRect(canvas.width/2-200,canvas.height/2-80,400,160);
    ctx.fillStyle="white"; ctx.font="48px Arial"; ctx.textAlign="center";
    ctx.fillText("RESPAWN", canvas.width/2, canvas.height/2 - 10);
    ctx.font="22px Arial";
    ctx.fillText("PRESS ENTER OR SPACE", canvas.width/2, canvas.height/2 + 40);
    ctx.textAlign="start";
  }

  if(win && winImg.complete){
    ctx.drawImage(winImg, canvas.width/2-250, canvas.height/2-180,500,360);
    ctx.fillStyle="white"; ctx.font="30px Arial"; ctx.textAlign="center";
    ctx.fillText("PRESS ENTER TO PLAY AGAIN", canvas.width/2, canvas.height/2 + 140);
    ctx.textAlign="start";
  }
}

// ------- LOOP -------
let lastTime=performance.now();
function loop(){
  const now=performance.now();
  const delta=(now-lastTime)/1000;
  lastTime=now;

  if(!gameOver && !win){
    survivalTime+=delta;
    updatePlayer();
    updateEnemies();
  }
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

// ------- RESET -------
window.addEventListener("keydown", e=>{
  if((e.key==="Enter"||e.key===" ")&&(gameOver||win)){
    resetGame();
  }
});

function resetGame(){
  player={ x:100,y:0,w:50,h:50,originalW:50,originalH:50, vx:0,vy:0,speed:5,jumpPower:15, grounded:false,facing:1 };
  enemies=[];
  boss=null;
  bossAppeared=false;
  invincible=false;
  win=false;
  gameOver=false;
  killCount=0;
  survivalTime=0;
  lastEnemySpawn=Date.now();
  currentBg=bgDefault;
  monitoSound.pause(); monitoSound.currentTime=0;
}

// ------- MUSIC -------
document.getElementById("musicBtn").addEventListener("click",()=>{
  if(bgMusic.paused){
    bgMusic.play();
    musicBtn.textContent="Music On";
  } else {
    bgMusic.pause();
    musicBtn.textContent="Music Off";
  }
});

// ------- BEEP -------
function beep(freq, duration=0.1){
  const ctx=new AudioContext();
  const o=ctx.createOscillator();
  const g=ctx.createGain();
  o.connect(g); g.connect(ctx.destination);
  o.frequency.value=freq;
  o.type="square";
  g.gain.value=0.1;
  o.start(); o.stop(ctx.currentTime+duration);
}

// ------- START MESSAGE -------
setTimeout(()=>{
  const msg=document.getElementById("startMsg");
  msg.style.opacity=0;
  setTimeout(()=> msg.remove(),1000);
},3000);

document.body.addEventListener("keydown",()=>bgMusic.play(),{once:true});
document.body.addEventListener("click",()=>bgMusic.play(),{once:true});
</script>
</body>
</html>
